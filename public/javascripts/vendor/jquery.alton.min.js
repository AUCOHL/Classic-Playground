/* ===============================================================================
 * alton.js v1.2.0
 * ===============================================================================
 * Copyright 2014 Paper Leaf Design
 * http://www.paper-leaf.com
 *
 * Author: Paper Leaf
 *
 * A full featured scrolling plugin for creating
 * immersive featured sections or headers.
 *
 * Credit:
 * is_mobile() based off these helpful posts
 * - http://stackoverflow.com/questions/3514784/what-is-the-best-way-to-detect-a-handheld-device-in-jquery
 *
 * Getting stable scroll events was helped hugely by Huge Inc's insights
 * - http://www.hugeinc.com/ideas/perspective/scroll-jacking-on-hugeinc
 *
 * Stabilizing keypress events was helped in large part by jQuery OnePage Scroll
 * - https://github.com/peachananr/onepage-scroll
 *
 * License: GPL v3
 * =============================================================================== */
(function(a){var b={firstClass:"header",fullSlideContainer:"full",singleSlideClass:"slide",nextElement:"div",previousClass:null,lastClass:"footer",slideNumbersContainer:"slide-numbers",bodyContainer:"pageWrapper",scrollMode:"featuredScroll",useSlideNumbers:false,slideNumbersBorderColor:"#fff",slideNumbersColor:"#000",animationType:"slow"};a.fn.alton=function(e){var D=a.extend(true,{},b,e),k=D.singleSlideClass,J,c,p=false,n=false,v=a("."+D.firstClass),u=a("."+k+":first"),d=null,m=a("."+D.lastClass),B=a("."+D.fullSlideContainer).children().length,E,r=true,A=0,H=0,o=a(window).outerHeight(),t=false,C=window.document.documentElement,q,K,z;if("getElementsByClassName" in document){J=document.getElementsByClassName(k)}else{J=document.querySelectorAll("."+k)}if(!v.length){v=u;u=v.next()}if(!m.length){m=a("."+k+":last")}m=m[0];if(D.scrollMode==="headerScroll"){v=a("."+D.firstClass);u=a("."+D.bodyContainer+":first")}function h(i){if(i==="featuredScroll"){for(z=J.length-1;z>=0;z-=1){if(I()){if(a(J[z]).height()>o){a(J[z]).css("height",a(J[z]).height())}else{a(J[z]).css("height",o);a(J[z]).outerHeight(o)}}else{a(J[z]).css("height",o);a(J[z]).outerHeight(o)}}if(D.useSlideNumbers&&!I()){a("."+D.bodyContainer).append('<div id="'+D.slideNumbersContainer+'"></div>');a("#"+D.slideNumbersContainer).css({height:"100%",position:"fixed",top:0,right:"0px",bottom:"0px",width:"86px","z-index":999});if(I()){a("#"+D.slideNumbersContainer).css({height:"auto","min-height":"100%"})}a("."+D.bodyContainer+" #"+D.slideNumbersContainer).append("<ul></ul>");a("."+D.bodyContainer+" #"+D.slideNumbersContainer+" ul").css({transform:"translateY(-50%)","-moz-transform":"translateY(-50%)","-ms-transform":"translateY(-50%)","-o-transform":"translateY(-50%)","-webkit-transform":"translateY(-50%)",top:"50%",position:"fixed"});var L=0;while(L<B){a("."+D.bodyContainer+" #"+D.slideNumbersContainer+" ul").append('<li class="paginate"></ul>');if(s()){a(".paginate").css({cursor:"pointer","border-radius":"50%","list-style":"none",background:D.slideNumbersBorderColor,"border-color":D.slideNumbersBorderColor,"border-width":"2px","border-style":"solid",height:"11px",width:"11px",margin:"5px 0"})}else{a(".paginate").css({cursor:"pointer","border-radius":"50%","list-style":"none",background:D.slideNumbersBorderColor,"border-color":D.slideNumbersBorderColor,"border-width":"2px","border-style":"solid",height:"10px",width:"10px",margin:"5px 0"})}L+=1}if(("getElementsByClassName" in document)){E=document.getElementsByClassName("paginate")}else{E=document.querySelectorAll(".paginate")}}}else{a("."+D.firstClass).css("height",o+10);if(!a("."+D.firstClass).hasClass("active")){a("."+D.firstClass).toggleClass("active");if(s()){a(".paginate.active").css({"margin-left":"-1px","border-color":"#"+D.slideNumbersBorderColor,"border-style":"solid","border-width":"2px",height:"8px",width:"8px"})}}}}function s(){var L=window.navigator.userAgent;var i=L.indexOf("MSIE ");if(i>0||navigator.userAgent.match(/Trident.*rv\:11\./)){return true}else{return false}}function I(){return navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|BB10|Windows Phone|Tizen|Bada)/)}function G(L,i){if(i&&a(E[a(L).parent().children().index(L)]).hasClass("active")){a(E[a(L).parent().children().index(L)]).toggleClass("active");a(E[a(L).parent().children().index(L)]).css("background",D.slideNumbersBorderColor)}else{if(!a(E[a(L).parent().children().index(L)]).hasClass("active")){a(E[a(L).parent().children().index(L)]).toggleClass("active");a(E[a(L).parent().children().index(L)]).css("background",D.slideNumbersColor)}}}function x(i){if(D.useSlideNumbers){if(i){a("#"+D.slideNumbersContainer).fadeIn()}else{a("#"+D.slideNumbersContainer).fadeOut()}}}function y(L){var i=document.getElementsByClassName(k);a(document).scrollTo(a(i[L]));v=i[L];if(a(v).prev().hasClass(k)){d=a(v).prev()}else{d=a("."+D.firstClass)}if(a(v).next().hasClass(k)){u=a(v).next()}else{u=a("."+D.lastClass)}G(a("#"+D.slideNumbersContainer+" li.active"),true);G(i[L],false)}function F(){if(a(u).length>0||a(d).length>0){if(a(window).scrollTop()>=a("."+k+":first").offset().top&&a(window).scrollTop()+a(window).outerHeight()!==a(document).outerHeight()){if(D.useSlideNumbers){G(v,true)}a("."+k).each(function(){K=a(this).offset().top;if(K<=a(window).scrollTop()){if(a(this).prev().hasClass(k)){d=a(this).prev()}else{d=a("."+D.firstClass)}v=a(this);if(v.next().hasClass(k)){u=a(this).next()}else{u=a("."+D.lastClass)}r=false}});if(D.useSlideNumbers){G(v,false)}a(document).scrollTo(v)}else{if(D.useSlideNumbers){if(m!==a("."+k+":last-child")[0]){x(false)}else{x(true);G(v,false)}}a(document).scrollTo(v)}}}function l(i){if(i!=undefined){i=i||window.event;if(i.preventDefault){i.stopPropagation();i.returnValue=false}}}function j(i){return l(i)}a.fn.moveDown=function(){q=w();if(q>=0&&(q<=a(v).scrollTop())&&r===true){d=v;v=u;u=v.next();if(D.useSlideNumbers){if(m===a("."+k+":last-child")[0]){G(d,true);G(v,false)}else{G(v,false);x(true)}}r=false;a(document).scrollTo(v)}else{if(!c&&u&&a(v).offset().top<q+1){if(u.hasClass(k)){d=v;v=u;u=a(v).next();if(D.useSlideNumbers){G(d,true);G(v,false)}a(document).scrollTo(v)}else{if(m!==a("."+k+":last-child")[0]){d=a("."+k+":last-child")[0];v=m;u=null;if(a(window).scrollTop()+o+10>=a(document).outerHeight()-a(m).outerHeight()){if(D.useSlideNumbers){G(d,false);x(false)}}a(document).scrollTo(v);a.event.trigger({type:"lastSlide",slide:m,time:new Date()})}}}}};a.fn.moveUp=function(){q=w();if(a("."+D.fullSlideContainer).offset().top+1>q&&d&&q>0){if(a(v).offset().top>=q){v=a("."+D.firstClass);d=null;u=a("."+k);if(D.useSlideNumbers){x(false);G(u,false)}r=true}else{v=d;d=null;u=a("."+k);if(D.useSlideNumbers){G(v,true);G(d,true)}}a(document).scrollTo(v)}else{if(!c&&a("."+D.fullSlideContainer).offset().top<q){v=d;d=a(v).prev();u=a(v).next();if(D.useSlideNumbers){G(v,false);G(u,true);x(true)}a(document).scrollTo(v)}}n=true;p=false};a.fn.scrollTo=function(i){if(i!==m){a("body,html").stop(true,true).animate({scrollTop:a(i).offset().top},{duration:375})}else{a("body,html").stop(true,true).animate({scrollTop:a(document).outerHeight()-o},{duration:375})}};function w(){return window.pageYOffset||C.scrollTop}function g(i){c=a("body,html").is(":animated")||a("body").is(":animated")||a("html").is(":animated");if(i.type=="mousewheel"||i.type=="DOMMouseScroll"){clearTimeout(a.data(this,"scrollTimer"));a(document).unbind({scroll:g});a.data(this,"scrollTimer",setTimeout(function(){t=false;a(document).bind({scroll:g})},35));if(i.originalEvent.detail>1&&!t||i.originalEvent.wheelDelta<-1&&!t){H+=1;a(document).moveDown();t=true;l()}else{if(i.originalEvent.detail<-1&&!t||i.originalEvent.wheelDelta>1&&!t){A+=1;a(document).moveUp();t=true;l()}}}else{if(i.type=="scroll"){l();t=false;clearTimeout(a.data(this,"scrollTimer"));a.data(this,"scrollTimer",setTimeout(function(){F()},500))}}return false}function f(i){q=w();if(i.originalEvent.detail>0||i.originalEvent.wheelDelta<0){if(a(u).offset().top>0&&q<a("."+D.firstClass).outerHeight()){if(a("."+D.firstClass).hasClass("active")){a("."+D.firstClass).toggleClass("active");a(document).scrollTo(u);d=v;v=u;return j(i)}else{if(!a("html, body").is(":animated")){return true}}}else{return true}}else{if(!a("."+D.firstClass).hasClass("active")&&a(window).scrollTop()<=a("."+D.firstClass).outerHeight()){a("."+D.firstClass).toggleClass("active");a(document).scrollTo(d);u=v;v=d}else{if(!a("html, body").is(":animated")){return true}}}return false}a(document).ready(function(){h(D.scrollMode);if(D.scrollMode==="featuredScroll"&&!I()){F()}if(D.scrollMode==="featuredScroll"&&!I()){a("#"+D.slideNumbersContainer+" li").on("click",function(){y(a(this).parent().children().index(this))});var i=[];onkeydown=onkeyup=function(L){L=L||event;i[L.which]=L.type=="keyup";switch(L.which){case 40:L.preventDefault();a(document).moveDown(L);break;case 32:L.preventDefault();if(i["16"]==true){a(document).moveUp(L)}else{a(document).moveDown(L)}break;case 33:a(document).moveDown(L);L.preventDefault();break;case 34:L.preventDefault();a(document).moveUp(L);break;case 38:L.preventDefault();a(document).moveUp(L);break;case 36:L.preventDefault();if(a("."+D.firstClass).length!==0){if(D.useSlideNumbers){G(v,true)}d=null;v="."+D.firstClass;u=a("."+k+":first");if(D.useSlideNumbers){G(v,false)}a(document).scrollTo("."+D.firstClass)}else{if(D.useSlideNumbers){G(v,true)}d=null;v=a(".pane:first");u=v.next();a(document).scrollTo(a(".pane")[0]);if(D.useSlideNumbers){G(v,false)}}break;case 35:if(a("."+D.firstClass).length!==0){if(D.useSlideNumbers){G(a(v),true);G(a(".pane:last"),false)}d=a(".pane:last")}else{if(D.useSlideNumbers){G(a(v),true);G(a(m),false)}d=a(m).prev()}v=a(m);u=null;L.preventDefault();a(document).scrollTo(m)}}}if(!I()){if(D.scrollMode==="featuredScroll"){a(document).bind({"DOMMouseScroll mousewheel scroll":g})}else{if(D.scrollMode==="headerScroll"){a(document).bind({"DOMMouseScroll mousewheel":f})}}a(window).resize(function(){a(J).each(function(){a(this).css("height",a(window).outerHeight());a(this).outerHeight(a(window).outerHeight())})})}})}})(jQuery);